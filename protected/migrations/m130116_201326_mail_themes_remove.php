<?php

class m130116_201326_mail_themes_remove extends CDbMigration
{
	public function up()
	{
        $connection = $this->getDbConnection();
        $transaction = $connection->beginTransaction();
        $connection->createCommand("SET FOREIGN_KEY_CHECKS = 0")->execute();
        try
        {
            $mail_template = $connection->createCommand("SELECT `t`.`id`, `t`.`subject_id` FROM `mail_template` AS `t`")->queryAll();
            $mail_themes = $connection->createCommand("SELECT `t`.`id`, `t`.`name` FROM `mail_themes` AS `t`")->queryAll();
            $mail_character_themes = $connection->createCommand("SELECT `t`.`id`, `t`.`theme_id` FROM `mail_character_themes` AS `t`")->queryAll();
            //$mail_template = $this->execute("SELECT `t`.`id`, `t`.`subject_id` FROM `mail_template` AS `t`");
            //$mail_themes = $this->execute("SELECT `t`.`id`, `t`.`name` FROM `mail_themes` AS `t`");
            //$mail_character_themes = $this->execute("SELECT `t`.`id`, `t`.`theme_id` FROM `mail_character_themes` AS `t`");
            $this->addColumn('mail_character_themes','text', "varchar(250) COMMENT 'Text for subject' AFTER `character_id`");
            $new_mail_character_themes = [];
            $mail_template_updates = 0;
            $mail_character_themes_updates = 0;
            foreach($mail_themes as $key => $theme) {
                $theme_not_found = true;
                $theme_id = null;
                foreach($mail_character_themes as $key2 => $character_theme) {

                    if($theme['id'] == $character_theme['theme_id']) {
                        $connection->createCommand("UPDATE `mail_character_themes` SET `text` = '".$theme['name']."' WHERE `theme_id` = ".$theme['id'])->execute();
                        //$this->update('mail_character_themes', ['text'=>$theme['name']], "`theme_id` = ".$theme['id']);
                        $theme_id = $character_theme['id'];
                        $theme_not_found = false;
                        $mail_character_themes_updates++;
                        unset($mail_character_themes[$key2]);
                    }

                }
                if($theme_not_found){
                    $connection->createCommand("INSERT INTO `mail_character_themes` SET `text` = '{$theme['name']}'")->execute();
                    //$this->insert('mail_character_themes', ['text'=>$theme['name']]);
                    $theme_id = $connection->lastInsertID;
                    $new_mail_character_themes[] = ['id'=>$connection->lastInsertID, 'text'=>$theme['name']];
                }

                foreach($mail_template as $key3 => $template) {
                    if($theme['id'] == $template['subject_id']) {
                        $connection->createCommand("UPDATE `mail_template` SET `subject_id` = ".$theme_id." WHERE `id` = ".$template['id'])->execute();
                        //$this->update('mail_template', ['subject_id'=>$theme_id], "`id` = ".$template['id']);
                        $mail_template_updates++;

                        unset($mail_template[$key3]);
                    }
                }
                if($theme_not_found === false){
                    unset($mail_themes[$key]);
                }

            }
            $this->dropColumn('mail_character_themes', 'theme_id');
            $this->dropColumn('mail_template', 'subject');
            $this->dropTable('mail_themes');

            if(!empty($mail_character_themes)) {
                echo "[mail_character_themes] \r\n";
                var_dump($mail_character_themes);
                throw new Exception('failed $mail_character_themes is not empty');
            }
            if(!empty($mail_template)) {
                echo "[mail_template] \r\n";
                var_dump($mail_template);
                throw new Exception('failed $mail_template is not empty');
            }

            if(count($mail_themes) !== count($new_mail_character_themes)) {
                echo "[mail_themes] \r\n";
                var_dump($mail_themes);
                echo "[new_mail_character_themes] \r\n";
                var_dump($new_mail_character_themes);
                throw new Exception("failed `mail_themes`(".count($mail_themes).") != `new_mail_character_themes`(".count($new_mail_character_themes)."})");
            }

            echo $mail_template_updates." updates in `mail_template` \r\n";
            echo $mail_character_themes_updates." updates in `mail_character_themes` \r\n";
            echo count($new_mail_character_themes)." inserts in `mail_character_themes` \r\n";
            echo count($mail_themes)." not updates `mail_themes` rows in `mail_character_themes` \r\n";
            echo count($mail_character_themes)." not updates in `mail_character_themes` \r\n";
            echo "done! \r\n";
            $transaction->commit();
            $connection->createCommand("SET FOREIGN_KEY_CHECKS = 1")->execute();

        }
        catch(Exception $e)
        {
            echo "Exception: ".$e->getMessage()."\n";
            $transaction->rollback();
            $connection->createCommand("SET FOREIGN_KEY_CHECKS = 1")->execute();
            return false;
        }
        /*echo "rollback change? 'yes/no' [yes]";
        $line = trim(fgets(STDIN));
        if(in_array($line, ['', 'yes','y','да', 'д'], false)) {
            $transaction->rollback();
            return false;
        } else {
            $transaction->commit();
            return true;
        }*/


	}

	public function down()
	{
        $connection = $this->getDbConnection();
        $transaction = $connection->beginTransaction();
        try
        {
$mail_template = "
SET NAMES utf8;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
--  Table structure for `mail_template`
-- ----------------------------
DROP TABLE IF EXISTS `mail_template`;
CREATE TABLE `mail_template` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `group_id` int(11) NOT NULL DEFAULT '5',
  `sender_id` int(11) NOT NULL,
  `receiver_id` int(11) NOT NULL,
  `subject` varchar(255) DEFAULT NULL,
  `sending_date` int(11) DEFAULT NULL,
  `receiving_date` int(11) DEFAULT NULL,
  `message` text,
  `subject_id` int(11) DEFAULT NULL,
  `code` varchar(5) NOT NULL,
  `sending_time` int(11) DEFAULT NULL,
  `type` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'Столбец нужен для типа сообщения 1 - Входящие, 2 - Исходящие, 3 - Входящие(доставлен), 4 - Исходящие(доставлен)',
  `sending_time_str` varchar(5) DEFAULT NULL,
  `sending_date_str` varchar(10) DEFAULT NULL,
  `type_of_importance` enum('none','2_min','plan','info','first_category','spam','reply_all') DEFAULT 'none' COMMENT 'Is it spam, is it impotrant etc. None - not desided by game autor jet.',
  PRIMARY KEY (`id`),
  UNIQUE KEY `mail_code_unique` (`code`),
  KEY `fk_mail_template_group_id` (`group_id`),
  KEY `fk_mail_template_sender_id` (`sender_id`),
  KEY `fk_mail_template_receiver_id` (`receiver_id`),
  KEY `fk_mail_template_subject_id` (`subject_id`)
) ENGINE=InnoDB AUTO_INCREMENT=97 DEFAULT CHARSET=utf8 COMMENT='Шаблоны писем';

-- ----------------------------
--  Records of `mail_template`
-- ----------------------------

INSERT INTO `mail_template` VALUES
('1', '1', '4', '1', 'По ценовой политике', '1331375520', null, 'Добрый день! \n\nЯ немного с опережением сделала работу по ценовой политике (вчера выдался свободный вечер). Мне кажется, что я отразила все мысли, которые мы обсуждали на установочной встрече. Будет время в отпуске - посмотрите. \n\nС уважением, Марина Крутько  \nВедущий аналитик отдела анализа и планирования', '291', 'MY1', '632', '3', '10:32', '03.10.2012', 'none'), ('2', '1', '11', '1', 'Форма отчетности для производства', '1331377320', null, 'Доброго вам времени суток! \nПроизводственный отдел просит вас рассмотреть возможность внесения изменений в текущую форму отчетности по объемам производства и производственным мощностям. На текущий момент в отчетности не достает развернутого анализа остатков на всех наших складах, включая торговые. Это приводит к тому, что мы периодически производим товар, который уже есть в регионах. Логисты говорят, что вполне могли бы обеспечить перебросу товара из одного региона в другой. Таким образом, нам удалось бы сэкономить на производственных издержках без снижения объемов продаж. Прошу вас оценить сроки, трудоемкость и наличие возможности добавить в производственный отчет данные по складским остаткам.\nЗаранее благодарю, Бобр В.,  \nНач. производственного отдела.', '146', 'MY2', '662', '3', '11:02', '03.10.2012', 'none'), ('3', '1', '13', '1', 'Новая система мотивации', '1397069100', null, 'Коллеги, добрый день!        \nПосле нескольких продуктивных совещаний с вами (отдельное спасибо Федорову А. за регулярное участие!) мы подготовили итоговую версию системы мотивации для менеджеров первого и второго уровня. Мы планируем вводить ее в действие с начала 02 года (именно она и будет забюджетирована). Ждем ваших окончательных комментариев и корректировок. Если не участвуете в обсуждении - потом не сетуйте на то, что система была принята без вашего весомого голоса! Благодарю за оперативность! \nС наилучшими пожеланиями, Людовкина С.', '292', 'MY3', '1125', '3', '18:45', '28.09.2012', 'none'), ('4', '1', '18', '1', 'Трудовой договор', '1326213000', null, 'Коллеги! В связи с изменениями трудового законодательства юридический отдел вынужден внести в трудовой договор, действующий в данный момент в компании как основной, ряд корректив. Просим вас ознакомиться с ними и донести до своих сотрудников, что с 01 января 02 года будет запущена кампания по подписанию такого варианта трудового договора со всеми актуальными и вновь пришедшими сотрудниками компании. Просим отнестить к этой работе со всей ответственностью и должным вниманием. \nС уважением, Адвокатов Ю.', '293', 'MY4', '990', '3', '16:30', '01.10.2012', 'none'), ('5', '5', '9', '1', 'срочно! Отчетность', '1334071800', null, 'Добрый день, коллеги! \nЯ, как всегда, по срочному вопросу. Ни у кого ведь нет сомнений, что продажи крайне важны для компании?! Судя по тому, как у нас работает аналитически отдел - этот приоритет ему не ясен. Дело в том, что у нас регулярно запаздвает отчетность, я так работать не могу - данные приходят тогда, когдя я уже все продала, и планировать поздно. Таким образом, я и мои люди постоянно действуем вслепую!  И это по трем тысячам клиентов!  Какие у вас есть мнения, что с этим делать. ', '294', 'M1', '930', '1', '15:30', '04.10.2012', '2_min'), ('6', '5', '9', '1', 'срочно! Требования клиентов', '1334066700', null, 'Без комментариев - читайте сами!  Прошу ответ срочно!\nДиректор по продажам Скоробей А.М.     \n\nFwd:\n Уважаемая Алевтина Михайловна! Несколько раз обращался к вашим менеджерам, но воз и ныне там.  Нам очень не удобно работать с вашим текущим прайс-листом! Формат, выбранный вами, не позволяет закачивать цены автоматически и все приходится вбивать вручную. Это серьезно замедляет приемку товара и постановку его в продажи! Хочу отметить, что у всех ваших конкурентов прайс-листы сделаны современым способом и не требуют от нас таких трудозатрат. \n\nПрошу вас решить эту проблему как можно скорее, иначе со следующего месяца нам придется выставлять вам счет за работу людей, вбивающих ваши цены в нашу систему. \n\nС уважением, Горбатюк Е.Д. \nДиректор ООО \"Луч\"', '295', 'M2', '845', '1', '14:05', '04.10.2012', '2_min'), ('7', '5', '13', '1', 'твои аналитики', '1334064600', null, 'Алексей! \nЯ засекла всех твоих аналитиков на ресурсе по поиску работы. Даже новенького. Ну он еще пока может и не снимал своего объявления - ждет окончания испытательного срока, но вот другие… Что ты с ними делаешь? Бьешь что-ли? Тебе надо с ними поговорить. Я тебе трех аналитиков за 2 дня не найду!  \nВсего доброго, Людовкина С.', '296', 'M3', '810', '1', '13:30', '04.10.2012', 'plan'), ('8', '5', '8', '1', 'предложения', '1334059260', null, 'Привет, Леша! У нас началась подготовка к годовой стратегической сессии. Ты вечно не доволен форматом нашей презентации, которую заполняют все подразделения для отчета и планов. Шли свои предложения заранее, чтобы ничего не переделывать в пожарном режиме. Удачи, Олег', '297', 'M4', '721', '1', '12:01', '04.10.2012', 'plan'), ('9', '5', '16', '37', 'график отпусков срочно!', '1334062200', null, 'Срочно! Подготовить и переслать график отпусков на следующий год. Кто не шлет - в отпуск не идет!  \nОтдел кадров.', '298', 'M5', '770', '1', '12:50', '04.10.2012', 'plan'), ('10', '5', '7', '37', 'консультанты и новый проект', '1334055720', null, 'Внимание! Важно!\n \nУ нас начали работу консультанты по стратегии. Проект большой и важный, требует участия каждого! Просьба всем, как можно скорее, согласовать свои встречи с консультантами! \n\nЭто просьба Генерального Директора. \n\nС уважением, ассистент ГД Долгова Н.Т.', '299', 'M6', '662', '1', '11:02', '04.10.2012', 'info'), ('11', '5', '14', '37', 'пришлите срочно пожелания!', '1334058000', null, 'Коллеги! \nТретий раз прошу всех переслать свои пожелания по закупке офисной мебели и планы по ремонту, я из-за вас не могу бюджет сдать нормальный. Всем, кто уже прислал - спасибо! Жду до конца сегодняшнего дня.  \nС уваженим, Хозин.', '300', 'M7', '700', '1', '11:40', '04.10.2012', 'info'), ('12', '5', '10', '1', '!проблема с сервером!', '1334055660', null, 'Алексей, срочный вопрос! \n\nМы протестировали ваш сервер на предмет восстановления и ап-грейда. Ребята возились с ним почти неделю, к сожалению, восстановлению и ремонту он не подлежит! Нужно менять срочно! \n\nВ нашем бюджете денег на смену сервера не предусмотрено. Я так понимаю, ты тоже такого форс-мажора не предвидел?!\n\nПиши служебку на деньги. Надо ХХ тыс. на ЕХ5 сервер (менее мощный покупать бессмысслено). \n\nПротянешь - будем разгребать проблемы с потерей информации. Мне ваши объемы информации хранить негде. \n\nВсего, Семен', '301', 'M8', '661', '1', '11:01', '04.10.2012', 'first_category'), ('13', '5', '4', '1', 'Презентация для ГД_рабочая версия', '1334016000', null, 'Добрый день! \n\nПересылаю пока сырую презентацию для ГД.  Что делать дальше мне ясно. Устраивает ли вас структура? Все данные для ее заполнения у меня готовы. Постараюсь завершить работу к 15.30. \n\nС уважением, Марина Крутько \nВедущий аналитик отдела анализа и планирования.', '302', 'M9', '0', '1', '', '04.10.2012', 'plan'), ('14', '5', '4', '1', 'Презентация для ГД_итог', '1334071800', null, 'Алексей, пересылаю итоговую версию презентации для ГД. Я бы еще поработала над оформлением, но суть уже закончена и можно показывать. Жду обратной связи. \n\nС уважением, Марина Крутько Ведущий аналитик отдела анализа и планирования.', '303', 'M10', '930', '1', '15:30', '04.10.2012', 'first_category'), ('15', '5', '4', '1', 'Презентация для ГД_драфт версия', '1334016000', null, 'Отправляю все, что есть. Версия черновая. \n\nС уважением, Марина Крутько Ведущий аналитик отдела анализа и планирования.', '304', 'M11', '0', '1', '', '04.10.2012', 'plan'), ('16', '5', '2', '1', 'Звонок нач.производства Бобра В.', '1334016000', null, 'Прошу не отвлекать меня от работы по вопросам, относящимся к твоей зоне ответственности.  Спроси у меня еще как цифры в excel поменять! \nДенежная Р.Р.', '305', 'M12', '0', '1', '', '04.10.2012', 'info'), ('17', '5', '12', '1', 're: бюджет логистики', '1334016000', null, 'Привет, Алексей! Проверяю. Как будет готов - перешлю. \nУдачи, Трудякин', '331', 'M31', '0', '1', '', '04.10.2012', 'info'), ('18', '5', '12', '1', 're: re: re: бюджет логистики', '1334016000', null, 'Прекрати отвлекать от работы! \nТрудякин.', '595', 'M33', '0', '1', '', '04.10.2012', 'info'), ('19', '5', '12', '1', 'бюджет логистики', '1334016000', null, 'Алексей! Пересылаю бюджет логистики на 02 год. \nС уважением, Трудякин.', '137', 'M34', '0', '1', '', '04.10.2012', 'info'), ('20', '5', '12', '1', 'форма по задаче от логистики, срочно!', '1334016000', null, 'Алексей, прикрепляю форму для выгрузки данных. \nСделайте точно в этом разрезе по прошедшим девяти месяцам 01 года. \nСпасибо за помощь! \nТрудякин.', '308', 'M41', '0', '1', '', '04.10.2012', 'first_category'), ('21', '5', '3', '12', 'выгрузка для логистов', '1334016000', null, 'Добрый день! Заполнил вашу форму. Есть ли вопросы? \nВсего доброго, Трутнев С.', '309', 'M43', '0', '1', '', '04.10.2012', 'info'), ('22', '5', '3', '1', 'выгрузка для логистов', '1334016000', null, 'Вот, сделал. Смотрите. \nС уваженим, Трутнев С.', '309', 'M44', '0', '1', '', '04.10.2012', 'info'), ('23', '5', '25', '1', 'данные по рынку, срочно нужна помощь!', '1334056500', null, 'Привет, Алексей! \n\nУ меня просьба, срочная! \nПришли, пожалуйста, данные по динамике рынка за 00 - 01 год (рост объемов продаж). Даже если вы исследований не делаете, то у вас процентов 50% всего рынка представлено в закупках. Легко можно экстраполировать на весь рынок. \n\nБез этих данных я не могу проверить корректность нашего бюджета. У меня на все осталось пять дней. \n\nОчень нужно, не подведи! \n\nЗаранее благодарю, Иван Доброхотов \nНач.отдела анализа и планирования ОАО \"Терминал\"', '310', 'M47', '675', '1', '11:15', '04.10.2012', '2_min'), ('24', '5', '11', '1', 'новый бюджет по производству', '1334070300', null, 'Уважаемый Алексей! \nПриношу извинения еще раз! Как я сказал по телефону, здесь нет нашей прямой вины. Очень постараемся не допускать такого в будущем году. Прошу Вас рассмотреть и включить новую версию в сводный бюджет. \nС глубочайшим уважением, Бобр В.', '311', 'M56', '905', '1', '15:05', '04.10.2012', 'info'), ('25', '5', '19', '1', 'обновление информации', '1334073660', null, 'Коллеги!         \nПросим всех сотрудников обновить информацию о номерах своих пенсионных свидетельтв. Часть из вас не сдала свидетельства еще с прошлого года!\nОбращаем ваше внимание, что следующая зп не будет начислена, если данные не будут представлены или обновлены.  \nБухгалтерия.', '312', 'M60', '961', '1', '16:01', '04.10.2012', 'spam'), ('26', '5', '24', '1', 're: обновление информации', '1334076300', null, 'Уважаемая бухгалтерия!  \nЯ передал вам информацию дважды, и вы все время ее теряете! Больше давать данные не стану - это дело принципа! Каждый должен выполнять свою работу: моя работа - заниматься производством, ваша - хранить данные!\nСерков А.Т.', '373', 'M61', '1005', '1', '16:45', '04.10.2012', 'spam'), ('27', '5', '19', '1', 're: re: обновление информации', '1334077380', null, 'Уважаемый Г-н Серков! \nВаши данные у нас есть. Можете не предоставлять. Однако не все в офисе столь же сознательные и ответственные. А данные ваша были утрачены не по вине бухгалтерии, а по причине отвратительно организованного переезда в новый офис. \nБухгалтерия.', '374', 'M62', '1023', '1', '17:03', '04.10.2012', 'spam'), ('28', '5', '14', '1', 're: re: re: обновление информации', '1334078220', null, 'Уважаемая бухгалтерия! \nДавайте не поднимать давно забытый скандал! Вы же даже сами тогда извинялись за свои необоснованные претензии. Для того, чтобы сохранить важные данные, их надо складывать в отведенные для этого места! \nНач.АХО, Хозин.', '375', 'M63', '1037', '1', '17:17', '04.10.2012', 'spam'), ('29', '5', '29', '1', 'есть лишний билет ', '1334074200', null, 'Леша, здорово!\nЕсть лишний билет на матч Лиги чемпионов Спартак-Барселона в сектор С. Поедешь с нами? Давно не виделись. Ответь срочно! \nОлег \n', '316', 'M64', '970', '1', '16:10', '04.10.2012', 'spam'), ('30', '5', '17', '1', 'вакцинация! ', '1334078580', null, 'Уважаемые коллеги, \nв понедельник в офисе будет проведена вакцинация. Время вакцинации вашего отдела с 10 до 12 в большой переговорной. Стоимость вакцинации включена в вашу страховку. Всем, кто не пройдет вакцинацию, больничный оплачиваться не будет.  \nОтдел персонала ', '317', 'M65', '1043', '1', '17:23', '04.10.2012', '2_min'), ('31', '5', '17', '1', 'новый сотрудник ', '1334070180', null, 'Уважаемые коллеги, \nк нашей компании присоединился новый сотрудник - - главный экономист - Сергей Иванович. Сергей Иванович работал в компании “LTD” более 10 лет. Прошу вас найти время и встретиться с ним, чтобы познакомиться и помочь войти в курс дела. \nОтдел  персонала', '318', 'M66', '903', '1', '15:03', '04.10.2012', 'spam'), ('32', '5', '30', '1', 'ДР отца', '1334074620', null, 'Леха, привет, братан!  Ты не забыл, что отцу 60 в конце этого месяца? Надо придумать подарок и организовать ресторан. Ты дернешь в отпуск - а я все буду делать один? Так не пойдет! Подарок я куплю, а ресторан бери на себя! Нам надо разместить человек двадцать, лучше без музыки и рядом с домом родителей - чтобы пешком. Найдешь - пиши адрес, я всех приглашу, так уж и быть!  \nСерый. \nP.S.Как думаешь, дядю Андрея приглашать? Он же брат, только вот они с отцом не очень...', '319', 'M67', '977', '1', '16:17', '04.10.2012', 'info'), ('33', '5', '19', '1', 'срок действия карты', '1334076300', null, 'Коллеги,  просим вас проверить дату истечения ваших кредитных карт. Сообщите нам, если ваша карта истекает в этом месяце, чтобы мы могли во время заняться перевыпуском. Напоминаем, если данные от вас не поступают, мы считаем, что ваша карта не нуждается в перевыпуске! \nБухгалтерия', '320', 'M68', '1005', '1', '16:45', '04.10.2012', 'spam'), ('34', '5', '31', '1', 'вакансия ', '1334080080', null, 'Алексей, приветствую.\n\nМы не знакомы лично. Ваш адрес мне дал наш общий знакомый с самыми лучшими рекомендациями вашего профессионализма.\n \nЯ руковожу фирмой “Легкий полет”, мы ищем опытного аналитика и менеджера для нашего планового отдела из 5 человек. \n\nБыло бы вам интересно обсудить возможность другой работы? \n\nС уважением,\nСтепанов Сергей ', '321', 'M69', '1068', '1', '17:48', '04.10.2012', 'spam'), ('35', '5', '32', '1', 'встреча выпускников в эту пятницу ', '1334073300', null, 'Дорогие мои, \nнадо чаще встречаться, как говорится в слогане известного пива. В эту пятницу будет 5 лет со дня нашего выпуска. Вы, конечно, все очень серьезные и занятые люди, но отказать мне не имеете права. Жду всех (я имею в виду всех, и тебя Леша, и тебя Ксюша) в 19.00 в Парке Культуры возле Бурана. Я подготовла для вас сюрприз. \nТолько немного намекну... “Он капитан, и родина его Марсель...” Помните?! \nВсех целую,\nваша вечная староста, \nМарина ', '322', 'M70', '955', '1', '15:55', '04.10.2012', 'spam'), ('36', '5', '13', '1', 'короткая просьба', '1334062980', null, 'Алексей, \nперешли мне. плз., описание позиции \"Аналитик\", по которому мы Лошадкина искали. Что-то не могу его у себя в компе найти, удалила что-ли...\nНадеюсь, за твой отпуск продвинемся и к твоему возвращению будет у тебя несколько кандидатов на встречу. Время сейчас хорошее.\nУдачи,\nЛюдовкина С.', '323', 'M71', '783', '1', '13:03', '04.10.2012', '2_min'), ('37', '5', '15', '1', 'отчет срочно!', '1334066580', null, 'Алексей, добрый день! \n\nМы проводим комплексный анализ работы подразделения в регионе С. В том числе нас интересует складской остаток на 01 число каждого месяца за весь текущий год. \n\nОгромная просьба подготовить этот отчет в ближайшие дни. Моя командировка закончится в понедельник, а мне еще надо провести инвентаризацию на базе данных, которые будут в этом отчете.\n\nСпасибо за помощь,\nАндрей Точных\nНач.службы внутреннего аудита', '324', 'M72', '843', '1', '14:03', '04.10.2012', '2_min'), ('38', '5', '20', '1', 'обучение регионального аналитика', '1334057700', null, 'Алексей, приветствую!\nЯ взял на работу регионального аналитика, как мы и договаривались. Надеюсь, что теперь у нас будут значительно быстрее проводится все операции. Вы мне обещали его натаскать и задать корпоративный стандарт работы. Он весь ваш!\nС уважением,\nКаменский В.П.\nИсполнительный директор регионального подразделения Д', '325', 'M73', '695', '1', '11:35', '04.10.2012', 'plan'), ('39', '5', '23', '1', 'запрос Крутько', '1334070000', null, 'Добрый день,\n\nВаша сотрудница М.Крутько прислана нам запрос на закупку нескольких фото файлов. Говорит, что нужны для презентации. Мы так не работаем. Нам нужен запрос от руководителя отдела и вообще-то это оформляется через служебку. Вы подтверждаете, что ей нужны файлы?\n\nОтдел рекламы и оформления\nПетрашевич И.', '326', 'M74', '900', '1', '15:00', '04.10.2012', '2_min'), ('40', '5', '12', '1', 'адрес клиента', '1334078220', null, 'Алексей,\nа дай-ка мне адресок какого-нибудь положительного клиента. Хочу ему пару вопросов задач, чтобы представить весь объем моих работ по проекту.\n\nСпасибо,\nТрудякин', '327', 'M75', '1037', '1', '17:17', '04.10.2012', '2_min'), ('41', '5', '22', '1', 'привет', '1334060580', null, 'Алексей, привет!\nТы меня спрашивал несколько дней назад когда я смогу тебе показать работу аналитической надстройки, что прислали наши подрядчики. Могу сегодня. Тебе в 4-5 дня подойдет?\n\nМягков Юра', '328', 'M76', '743', '1', '12:23', '04.10.2012', '2_min'), ('42', '5', '33', '1', 'по вашей заявке', '1334065680', null, 'Уважаемый Алексей!\n\nВы направляли в адрес нашей конференции заявку на участие в роли спикера. \n\nЗаявленная вами тема показалась оргкомитету актуальной и заслуживающей внимания.\n\nПросим вас подготовить тезисы вашего выступления и переслать их в наш адрес не позднее 30 октября.\n\nБлагодарим за ваше участие, \nОрганизационный комитет конференции \"Аналитика и бизнес\"\nИванова О.И.', '329', 'M77', '828', '1', '13:48', '04.10.2012', 'plan'), ('43', '3', '1', '2', 'Отчет для Правления', '1331396400', null, 'Раиса Романовна, добрый вечер!\n\nВо вложении файл с отчетом для Правления. Дайте знать, пожалуйста, есть ли замечания, постараюсь внести коррективы к дате встречи Правления. \n\nС уважением,\nФедоров А.', '103', 'MSY10', '980', '4', '16:20', '03.10.2012', ''), ('44', '5', '1', '2', 'Отчет для Правления - исправленный', '1334016000', null, 'Раиса Романовна, \n\nВо вложении скорректированный файл с отчетом для Правления.  \n\nС уважением,\nФедоров А.', '273', 'MS10', '0', '2', '', '04.10.2012', ''), ('45', '5', '1', '2', 'Служебная записка о сервере. Срочно!', '1334016000', null, 'Служебная записка', '106', 'MS20', '0', '2', '', '04.10.2012', ''), ('46', '5', '1', '4', 'Сводный бюджет: файл', '1334016000', null, 'Марина,\n\nво вложении - файл Сводного бюджета. Как мы и говорили, задача срочная. У нас есть всего три часа. Будут вопросы - обращайся!\n\nС уважением,\nА.Федоров', '183', 'MS21', '0', '2', '', '04.10.2012', ''), ('47', '5', '1', '3', 'Сводный бюджет: файл', '1334016000', null, 'Сергей,\n\nво вложении - файл Сводного бюджета. Как мы и говорили, задача срочная. У нас есть всего три часа. Будут вопросы - обращайся!\n\nС уважением,\nА.Федоров', '183', 'MS22', '0', '2', '', '04.10.2012', ''), ('48', '5', '1', '3', 'Методика формирования сводного бюджета', '1334016000', null, 'Сергей,\n\nво вложении - Методика формирования сводного бюджета. Думаю, она поможет ответить на все твои вопросы. Если что не понятно - обращайся!\n\nС уважением,\nА.Федоров', '117', 'MS23', '0', '2', '', '04.10.2012', ''), ('49', '5', '1', '6', 'Презентация на выставку', '1334016000', null, 'Уважаемый Валерий Семенович,\n\nво вложении - Презентация на выставку. \n\nГотов ответить на Ваши вопросы и дать комментарии!\n\nС уважением,\nА.Федоров', '109', 'MS25', '0', '2', '', '04.10.2012', ''), ('50', '5', '1', '3', 'Fwd: !проблема с сервером!', '1334016000', null, 'Сергей! \nПрочти сообщение ниже и срочно подготовь служебку на получение денег для сервера на имя Денежной. \n\nС уважением,\nФедоров А.\n\n', '376', 'MS27', '0', '2', '', '04.10.2012', ''), ('51', '5', '1', '11', 'Бюджет производства прошлого года', '1334016000', null, 'Уважаемый Василий,\n\nя нашел для вас последнюю итоговую версию бюджета производства прошлого года. Она во вложении.\n\nВсего доброго,\nФедоров А.', '144', 'MS28', '0', '2', '', '04.10.2012', ''), ('52', '5', '1', '3', 'задача: бюджет производства прошлого года', '1334016000', null, 'Сергей,\n\nпрошу тебя найти последнюю итоговую версию бюджета производства на 01 год и переслать ее Начальнику производственного отдела  Василию Бобру. Поставь меня в копию, пожалуйста.\n\nС уважением,\nФедоров А.', '119', 'MS29', '0', '2', '', '04.10.2012', ''), ('53', '5', '1', '12', 'бюджет логистики', '1334016000', null, 'Егор, приветствую!\n\nНесмотря на прошедший срок сдачи, так и не получил от вас бюджет логистики на 02 год. Надеюсь, что ты понимаешь, что отсутствие вашего бюджета задерживает весь процесс бюджетирования и формирования сводного. От меня требуется подготовить и сдать сводный бюджет в течение трех часов. Срочно жду от тебя бюджет логистики! \n\nС уважением,\nФедоров А.', '137', 'MS30', '0', '2', '', '04.10.2012', ''), ('54', '5', '1', '12', 're: re: бюджет логистики', '1334016000', null, 'Егор, \n\nвсе возможные сроки реакции на мою просьбу уже прошли! Я требую немедленно предоставить бюджет логистики или мне придется информировать Генерального директора о несоблюдении регламента. \n\nС уважением,\nФедоров А.', '571', 'MS32', '0', '2', '', '04.10.2012', ''), ('55', '5', '1', '2', 'Сводный бюджет', '1334016000', null, 'Вот сводный бюджет. Файл прикреплен', '101', 'MS35', '0', '2', '', '04.10.2012', ''), ('56', '5', '1', '2', 'Сводный бюджет: итоговые корректировки', '1334016000', null, 'Вот новый сводный бюджет. Изменения следующие….Файл прикреплен', '102', 'MS36', '0', '2', '', '04.10.2012', ''), ('57', '5', '1', '4', 're: Презентация для ГД_рабочая версия', '1334016000', null, 'Марина,\n\nя посмотрел наброски к презентации. Все в порядке, продолжай! Жду итоговый вариант к 15.30.\n\nС уважением,\nФедоров А.', '330', 'MS57', '0', '2', '', '04.10.2012', ''), ('58', '5', '1', '4', 're: Презентация для ГД_итог', '1334016000', null, 'хорошо, продолжай, о результатах встречи расскажу', '594', 'MS37', '0', '2', '', '04.10.2012', ''), ('60', '5', '1', '4', 'Презентация для ГД: распечатать', '1334016000', null, 'Распечатай столько-то к такому-то числу, в цвете. ', '126', 'MS39', '0', '2', '', '04.10.2012', ''), ('61', '5', '1', '3', 'Задача отдела логистики: статус', '1334016000', null, 'Сергей,\n\nнесколько дней назад логисты просили сделать для них выгрузку. Мы обсуждали с тобой эту задачу и сроки ее исполнения. Сегодня - срок сдачи работы. Перешли мне то, что у тебя получилось в ближайшие тридцать минут, пожалуйста. \n\nС уважением,\nФедоров А.', '185', 'MS58', '0', '2', '', '04.10.2012', ''), ('62', '5', '1', '3', 'Fwd: форма по задаче от логистики, срочно!', '1334016000', null, 'Логисты хотят получить данные в приложенной форме. За последние 9 месяцев. Сделай срочно! Думаю, что пару часов тебе хватит. Вложен пример формы.', '115', 'MS42', '0', '2', '', '04.10.2012', ''), ('63', '5', '1', '12', 're: форма по задаче от логистики, срочно!', '1334016000', null, 'Егор,\n\nво вложении - форма о твоему запросу. \n\nМы сделали срочно, как ты и просил.\n\nСообщи, пожалуйста, все ли вас устраивает и не осталось ли вопросов по этому заданию.\n\nС уважением,\nФедоров А.', '140', 'MS45', '0', '2', '', '04.10.2012', ''), ('64', '5', '1', '3', 'Fwd: данные по рынку, срочно нужна помощь!', '1334016000', null, 'По задаче ТЕ3.2 Подготовь отчет по данным от наших клиентов - по всему рынку. В нем должно быть отражено…..  И отправь Ивану Доброхотову - я в копии.', '113', 'MS46', '0', '2', '', '04.10.2012', ''), ('65', '5', '1', '2', 'Динамика производственных затрат', '1334016000', null, 'По задаче ТRC6 (o доле производственных затрат). Должен написать точно тему, хорошо струткурировать письмо. Сдлеть эту работу срочно после звонка.', '105', 'MS48', '0', '2', '', '04.10.2012', ''), ('66', '5', '1', '9', 'Бюджетирование в дирекции продаж', '1334016000', null, 'Давайте встретимся. У меня есть информация по процессу вашего бюджета. Есть что обсудить.ИЛИ  Разговаривал с вашим нач.отдела продаж региона А. Он рассказал о вашей системе планирования. Это безобразие! Это не верный метод. Вы таким образом ставите под угрозу бюджет всей компании. Дайте мне слово, что все поменяете, иначе я буду жаловаться ФД!', '274', 'MS49', '0', '2', '', '04.10.2012', ''), ('67', '5', '1', '2', 'Жалоба', '1334016000', null, 'Жалоба на ОК. Эти козлы время не согласовывают, а потом меня еще пугают!', '107', 'MS50', '0', '2', '', '04.10.2012', ''), ('68', '5', '1', '7', 'Данные по распечатке презентаций', '1334016000', null, 'Наталья Тимофеевна,\n\nБосс просил уточнить у вас следующую информацию относительно его презентации на выставке:\n1. Сколько копий нам надо распечатать.\n2. Кому передать распечатанные копии.\n3. Когда они должны быть переданы.\n\nСпасибо за информацию,\nФедоров А.', '161', 'MS51', '0', '2', '', '04.10.2012', ''), ('69', '5', '1', '3', 'Отчет по 3 кварталу', '1334016000', null, 'Стандартная работа по подготовке отчета по 3 кв. Начинай с продаж. К моему возвращению отчет должен быть у меня на проверку.', '116', 'MS54', '0', '2', '', '04.10.2012', ''), ('70', '5', '1', '39', 'Приглашение: новая система премирования', '1334016000', null, 'Коллеги,\n\nзавтра, в 12.00, приглашаю вас в мой кабинет для презентации новой системы премирования на 4 квартал.\n\nС уважением,\nФедоров А.', '163', 'MS55', '0', '2', '', '04.10.2012', ''), ('71', '5', '1', '9', 're: срочно! Отчетность', '1334016000', null, 'ответить всем и предложить встретиться для обсуждения этого вопроса, в неправильной версии - разъяснения, что аналитика понимает важность продаж, что отчетность сейчас собирается долго т.к. Не автоматизирован процесс сбора данных с клиентов, а мы этим сейчас занимаемся...', '149', 'MS40', '0', '2', '', '04.10.2012', 'reply_all'), ('72', '5', '1', '9', 're: срочно! Требования клиентов', '1334016000', null, 'предложить директору по продажам выяснить у других клиентов - так ли это у всех, если да, то выносить на общее обсуждение с участием наших ИТ-ков', '150', 'MS52', '0', '2', '', '04.10.2012', 'reply_all'), ('73', '5', '1', '2', 'План работ на завтра, пятница, 5 октября', '1334016000', null, 'Раиса Романовна\n\nПрикрепляю мой план на завтра. Завтра я должен уйти в 16.00, как я уже говорил вам ранее.\n\nС уважением,\nФедоров А.', '104', 'MS53', '0', '2', '', '04.10.2012', ''), ('74', '5', '1', '39', 'Fwd: вакцинация! ', '1334016000', null, 'Коллеги, вам нужно пройти вакцинацию в понедельник. Запланируйте в своих календарях, пожалуйста.\n\nС уваженим,\nФедоров А.\n', '164', 'MS65', '0', '2', '', '04.10.2012', ''), ('75', '5', '1', '15', 're: отчет срочно!', '1334016000', null, 'Аркадий, приветствую!\n\nОтчет сделаем. Данные будут у тебя завтра во второй половине дня.\n\nУдачи,\nФедоров А.', '165', 'MS66', '0', '2', '', '04.10.2012', ''), ('76', '5', '1', '3', 'Fwd: отчет срочно!', '1334016000', null, 'Сергей, \n\nвключи это задание в свой план работ, пожалуйста. Тебе необходимо выгрузить складской остаток в регионе С на 01 число каждого месяца с января по октябрь этого года. \n\nПрошу выполнить задание до двух дня, чтобы я мог его посмотреть перед отправкой. \n\nСпасибо,\nФедоров А.', '121', 'MS67', '0', '2', '', '04.10.2012', ''), ('77', '5', '1', '20', 're: обучение регионального аналитика', '1334016000', null, 'Добрый день, Виктор Петрович!\n\nОчень рад, что вы нашли аналитика!\n\nНепременно помогу вам с его обучением и адаптацией. Завтра с четрех я в отпуске, а потому, запланирую разговор с ним на первые дни недели после отпуска. ', '166', 'MS62', '0', '2', '', '04.10.2012', ''), ('78', '5', '1', '13', 're: короткая просьба', '1334016000', null, 'Хорошо, лови.', '154', 'MS63', '0', '2', '', '04.10.2012', ''), ('79', '5', '1', '23', 're: запрос Крутько', '1334016000', null, 'Да, сделайте. Подтверждаю.', '168', 'MS64', '0', '2', '', '04.10.2012', ''), ('80', '5', '1', '12', 're: адрес клиента', '1334016000', null, 'Адрес ниже.', '141', 'MS60', '0', '2', '', '04.10.2012', ''), ('81', '5', '1', '22', 're: привет', '1334016000', null, 'Привет, Юра! Сегодня и завтра, к сожалению, не могу. Давай запланируем после отпуска.', '167', 'MS61', '0', '2', '', '04.10.2012', ''), ('82', '5', '1', '4', 'встреча с ГД по презентации', '1334016000', null, 'Марина,\n\nБосс сегодня встречаться не смог, а завтра он на выезде. Потому прошу тебя встретиться с ним в понедельник в 10.00 для пояснений по презентации. Презентацию ему я уже отправил.\n\nНе волнуйся, я уверен, что ты справишься.\n\nСпасибо,\nФедоров А.', '124', 'MS68', '0', '2', '', '04.10.2012', ''), ('83', '5', '1', '12', 'Квартальный план', '1334016000', null, 'Егор, во вложении моя версия квартального плана.\n\nС уважениям,\nФедоров А.', '596', 'MS69', '0', '2', '', '04.10.2012', ''), ('84', '5', '1', '3', 'ошибка в отчете для правления', '1334016000', null, 'Сергей,\n\nты сделал ошибку в отчете для Правления, а я ее проустил. Опять получил сегодня выговор от Денежной. Исправь немедленно и пришли мне новую версию отчета.\n\nФедоров А.', '120', 'MS70', '0', '2', '', '04.10.2012', ''), ('85', '5', '1', '13', 're: твои аналитики', '1334016000', null, 'B1', '151', 'MS71', null, '2', null, null, ''), ('86', '5', '1', '8', 're: предложения', '1334016000', null, 'B1', '158', 'MS72', null, '2', null, null, ''), ('87', '5', '1', '10', 're: !проблема с сервером!', '1334016000', null, 'B1', '133', 'MS73', null, '2', null, null, ''), ('88', '5', '1', '4', 're: Презентация для ГД_рабочая версия', '1334016000', null, 'B1', '330', 'MS74', null, '2', null, null, ''), ('89', '5', '1', '12', 're: бюджет логистики', '1334016000', null, 'B1', '331', 'MS75', null, '2', null, null, ''), ('90', '5', '1', '12', 're: форма по задаче от логистики, срочно!', '1334016000', null, 'B1', '140', 'MS76', null, '2', null, null, ''), ('91', '5', '1', '3', 're: выгрузка для логистов', '1334016000', null, 'B1', '332', 'MS77', null, '2', null, null, ''), ('92', '5', '1', '3', 're: выгрузка для логистов', '1334016000', null, 'B1', '332', 'MS78', null, '2', null, null, ''), ('93', '5', '1', '25', 're: данные по рынку, срочно нужна помощь!', '1334016000', null, 'B1', '131', 'MS79', null, '2', null, null, ''), ('94', '5', '1', '11', 're: новый бюджет по производству', '1334016000', null, 'B1', '148', 'MS80', null, '2', null, null, ''), ('95', '5', '1', '4', 'Fwd: !проблема с сервером!', '1334016000', null, 'Марина! \nПрочти сообщение ниже и срочно подготовь служебку на получение денег для сервера на имя Денежной. \n\nС уважением,\nФедоров А.\n\n', '376', 'MS81', null, '2', null, null, ''), ('96', '5', '1', '4', 'задача: бюджет производства прошлого года', '1334016000', null, 'Марина,\n\nпрошу тебя найти последнюю итоговую версию бюджета производства на 01 год и переслать ее Начальнику производственного отдела  Василию Бобру. Поставь меня в копию, пожалуйста.\n\nС уважением,\nФедоров А.', '119', 'MS82', null, '2', null, null, '');


SET FOREIGN_KEY_CHECKS = 1;";

$mail_themes = "
SET NAMES utf8;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
--  Table structure for `mail_themes`
-- ----------------------------
DROP TABLE IF EXISTS `mail_themes`;
CREATE TABLE `mail_themes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(128) DEFAULT NULL,
  `sim_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_mail_themes_sim_id` (`sim_id`)
) ENGINE=InnoDB AUTO_INCREMENT=809 DEFAULT CHARSET=utf8 COMMENT='Темы писем';

-- ----------------------------
--  Records of `mail_themes`
-- ----------------------------

INSERT INTO `mail_themes` VALUES ('101', 'Сводный бюджет', null), ('102', 'Сводный бюджет: итоговые корректировки', null), ('103', 'Отчет для Правления', null), ('104', 'План работ на завтра, пятница, 5 октября', null), ('105', 'Динамика производственных затрат', null), ('106', 'Служебная записка о сервере. Срочно!', null), ('107', 'Жалоба', null), ('109', 'Презентация на выставку', null), ('113', 'Fwd: данные по рынку, срочно нужна помощь!', null), ('115', 'Fwd: форма по задаче от логистики, срочно!', null), ('116', 'Отчет по 3 кварталу', null), ('117', 'Методика формирования сводного бюджета', null), ('119', 'задача: бюджет производства прошлого года', null), ('120', 'ошибка в отчете для правления', null), ('121', 'Fwd: отчет срочно!', null), ('124', 'встреча с ГД по презентации', null), ('126', 'Презентация для ГД: распечатать', null), ('131', 're: данные по рынку, срочно нужна помощь!', null), ('133', 're: !проблема с сервером!', null), ('137', 'бюджет логистики', null), ('140', 're: форма по задаче от логистики, срочно!', null), ('141', 're: адрес клиента', null), ('144', 'Бюджет производства прошлого года', null), ('146', 'Форма отчетности для производства', null), ('148', 're: новый бюджет по производству', null), ('149', 're: срочно! Отчетность', null), ('150', 're: срочно! Требования клиентов', null), ('151', 're: твои аналитики', null), ('154', 're: короткая просьба', null), ('158', 're: предложения', null), ('161', 'Данные по распечатке презентаций', null), ('163', 'Приглашение: новая система премирования', null), ('164', 'Fwd: вакцинация! ', null), ('165', 're: отчет срочно!', null), ('166', 're: обучение регионального аналитика', null), ('167', 're: привет', null), ('168', 're: запрос Крутько', null), ('183', 'Сводный бюджет: файл', null), ('185', 'Задача отдела логистики: статус', null), ('273', 'Отчет для Правления - исправленный', null), ('274', 'Бюджетирование в дирекции продаж', null), ('291', 'По ценовой политике', null), ('292', 'Новая система мотивации', null), ('293', 'Трудовой договор', null), ('294', 'срочно! Отчетность', null), ('295', 'срочно! Требования клиентов', null), ('296', 'твои аналитики', null), ('297', 'предложения', null), ('298', 'график отпусков срочно!', null), ('299', 'консультанты и новый проект', null), ('300', 'пришлите срочно пожелания!', null), ('301', '!проблема с сервером!', null), ('302', 'Презентация для ГД_рабочая версия', null), ('303', 'Презентация для ГД_итог', null), ('304', 'Презентация для ГД_драфт версия', null), ('305', 'Звонок нач.производства Бобра В.', null), ('308', 'форма по задаче от логистики, срочно!', null), ('309', 'выгрузка для логистов', null), ('310', 'данные по рынку, срочно нужна помощь!', null), ('311', 'новый бюджет по производству', null), ('312', 'обновление информации', null), ('316', 'есть лишний билет ', null), ('317', 'вакцинация! ', null), ('318', 'новый сотрудник ', null), ('319', 'ДР отца', null), ('320', 'срок действия карты', null), ('321', 'вакансия ', null), ('322', 'встреча выпускников в эту пятницу ', null), ('323', 'короткая просьба', null), ('324', 'отчет срочно!', null), ('325', 'обучение регионального аналитика', null), ('326', 'запрос Крутько', null), ('327', 'адрес клиента', null), ('328', 'привет', null), ('329', 'по вашей заявке', null), ('330', 're: Презентация для ГД_рабочая версия', null), ('331', 're: бюджет логистики', null), ('332', 're: выгрузка для логистов', null), ('373', 're: обновление информации', null), ('374', 're: re: обновление информации', null), ('375', 're: re: re: обновление информации', null), ('376', 'Fwd: !проблема с сервером!', null), ('571', 're: re: бюджет логистики', null), ('594', 're: Презентация для ГД_итог', null), ('595', 're: re: re: бюджет логистики', null), ('596', 'Квартальный план', null), ('763', 'Просьба', null), ('764', 'Прочее', null), ('765', 'Деньги на сервер', null), ('766', 'Перенос сроков сдачи сводного бюджета', null), ('767', 'Задержка данных от логистов', null), ('768', 'Просьба перенести встречу по презентации', null), ('769', 'Индексация ЗП', null), ('770', 'Изменение бюджета производства вне регламента', null), ('771', 'Сводный бюджет: контроль', null), ('772', 'Задача отдела логистики: уточнения от Трутнева', null), ('773', 'Задача отдела логистики: итоговый файл', null), ('774', 'Служебная записка о сервере', null), ('775', 'Обратная связь по итоговому файлу перезентации', null), ('776', 'Задача отдела логистики', null), ('777', 're: По ценовой политике', null), ('778', 'по поводу увольнения', null), ('779', 'фото файлы', null), ('780', 'Встреча: уточнение', null), ('781', 'Разрешение дать контакт Трудякину', null), ('782', 'Встреча', null), ('783', 'Показатели за пять лет', null), ('784', 'Данные по продажам от клиентов', null), ('785', 'Обед', null), ('786', 'Доработка прайс-листа', null), ('787', 'Задача отдела логистики: уточнения', null), ('788', 'Задача отдела логистики: выполнена', null), ('789', 'Обсуждение сроков отчетности', null), ('790', 'Беседа с консультантами', null), ('791', 'Бюджет производства 02: коррективы', null), ('792', 're: Форма отчетности для производства', null), ('793', 're: Новая система мотивации', null), ('794', 'Испытательный срок Лошадкина', null), ('795', 'Увольнение Крутько', null), ('796', 're: пришлите срочно пожелания!', null), ('797', 'Ремонт кондиционера', null), ('798', 'Ремонт батерей', null), ('799', 'Предложения по презентации на стратегическую сессию', null), ('800', 're: консультанты и новый проект', null), ('801', 'Проект с консультантами: уточнение', null), ('802', 're: Трудовой договор', null), ('803', 'Увольнение сотрудника', null), ('804', 'требуемый формат прайс-листа', null), ('805', 'Fwd: Новая система мотивации', '6668'), ('806', 'Fwd: По ценовой политике', '6686'), ('807', 'Fwd: выгрузка для логистов', '6781'), ('808', 'Fwd: Форма отчетности для производства', '7014');


SET FOREIGN_KEY_CHECKS = 1;";

$mail_character_themes = "
SET NAMES utf8;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
--  Table structure for `mail_character_themes`
-- ----------------------------
DROP TABLE IF EXISTS `mail_character_themes`;
CREATE TABLE `mail_character_themes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `character_id` int(11) DEFAULT NULL,
  `theme_id` int(11) DEFAULT NULL,
  `letter_number` varchar(5) DEFAULT NULL,
  `wr` char(1) DEFAULT NULL,
  `constructor_number` varchar(5) DEFAULT NULL,
  `phone` tinyint(1) DEFAULT NULL,
  `phone_wr` char(1) DEFAULT NULL,
  `phone_dialog_number` varchar(12) DEFAULT NULL,
  `mail` tinyint(1) DEFAULT NULL,
  `source` varchar(32) DEFAULT NULL COMMENT 'Used to score user behaviour.',
  PRIMARY KEY (`id`),
  KEY `fk_mail_character_themes_character_id` (`character_id`),
  KEY `fk_mail_character_themes_theme_id` (`theme_id`),
  KEY `fk_mail_character_themes_letter_number` (`letter_number`)
) ENGINE=InnoDB AUTO_INCREMENT=716 DEFAULT CHARSET=utf8 COMMENT='Темы писем для персонажей';

-- ----------------------------
--  Records of `mail_character_themes`
-- ----------------------------

INSERT INTO `mail_character_themes` VALUES ('208', '2', '101', 'MS35', 'R', 'R1', null, '', '', '1', 'manual'), ('209', '2', '102', 'MS36', 'R', 'R2', null, '', '', '1', 'manual'), ('211', '2', '104', 'MS53', 'R', 'TXT', null, '', '', '1', 'dialogue'), ('212', '2', '105', 'MS48', 'R', 'R3', '1', 'W', 'AUTO', '1', 'dialogue'), ('213', '2', '106', 'MS20', 'R', 'R4', null, '', '', '1', 'inbox'), ('214', '2', '107', 'MS50', 'W', 'B1', null, '', '', '1', ''), ('220', '6', '109', 'MS25', 'R', 'TXT', null, '', '', '1', 'inbox'), ('225', '3', '183', 'MS22', 'W', 'TXT', null, '', '', '1', ''), ('227', '3', '113', 'MS46', 'R', 'R5', null, '', '', '1', 'inbox'), ('228', '3', '185', 'MS58', 'W', 'TXT', '1', 'R', 'T7.1', '1', ''), ('229', '3', '115', 'MS42', 'R', 'R6', null, '', '', '1', 'inbox'), ('232', '3', '116', 'MS54', 'W', 'W1', '1', 'W', 'AUTO', '1', ''), ('233', '3', '117', 'MS23', 'W', 'TXT', null, '', '', '1', ''), ('235', '3', '119', 'MS29', 'W', 'TXT', '1', 'W', 'AUTO', '1', ''), ('236', '3', '120', 'MS70', 'W', 'TXT', '1', 'W', 'AUTO', '1', ''), ('237', '3', '121', 'MS67', 'R', 'R13', null, '', '', '1', 'inbox'), ('245', '4', '124', 'MS68', 'W', 'TXT', null, '', '', '1', ''), ('247', '4', '126', 'MS39', 'R', 'R9', '1', 'W', 'T6.2', '1', 'manual'), ('249', '4', '113', null, 'W', 'W3', null, '', '', '1', ''), ('250', '4', '116', null, 'W', 'W4', '1', 'W', 'AUTO', '1', ''), ('253', '4', '119', 'MS82', 'W', 'TXT', '1', 'W', 'AUTO', '1', ''), ('258', '25', '131', null, 'N', 'B1', null, '', '', '1', ''), ('264', '10', '133', null, 'W', 'B1', null, '', '', '1', ''), ('269', '12', '137', 'MS30', 'W', 'TXT', '1', 'R', 'T3.1', '1', ''), ('274', '12', '140', 'MS45', 'R', 'TXT', null, '', '', '1', 'inbox'), ('275', '12', '141', 'MS60', 'R', 'R14', null, '', '', '1', 'inbox'), ('279', '11', '144', 'MS28', 'R', 'TXT', '1', 'W', 'AUTO', '1', 'dialogue'), ('282', '11', '148', null, 'W', 'B1', null, '', '', '1', ''), ('284', '9', '149', 'MS40', 'R', 'R10', null, '', '', '1', 'inbox'), ('285', '9', '150', 'MS52', 'R', 'R11', null, '', '', '1', 'inbox'), ('289', '13', '151', null, 'W', 'B1', null, '', '', '1', ''), ('292', '13', '154', 'MS63', 'R', 'B1', null, '', '', '1', 'inbox'), ('299', '8', '158', null, 'W', 'B1', null, '', '', '1', ''), ('304', '7', '161', 'MS51', 'R', 'TXT', '1', 'R', 'T6.1', '1', 'manual'), ('309', '39', '163', 'MS55', 'R', 'TXT', null, '', '', '1', 'manual'), ('310', '39', '164', 'MS65', 'R', 'TXT', null, '', '', '1', 'inbox'), ('312', '15', '165', 'MS66', 'R', 'TXT', null, '', '', '1', 'inbox'), ('314', '20', '166', 'MS62', 'R', 'R12', null, '', '', '1', 'inbox'), ('316', '22', '167', 'MS61', 'R', 'B1', null, '', '', '1', 'inbox'), ('318', '23', '168', 'MS64', 'R', 'B1', null, '', '', '1', 'inbox'), ('322', '2', '273', 'MS10', 'W', 'TXT', null, '', '', '1', ''), ('323', '4', '183', 'MS21', 'W', 'TXT', null, '', '', '1', ''), ('324', '9', '274', 'MS49', 'W', 'W12', '1', 'R', 'RS8.1', '1', ''), ('325', '3', '376', 'MS27', 'W', 'TXT', null, '', '', '1', ''), ('326', '4', '376', 'MS81', 'W', 'TXT', null, '', '', '1', ''), ('423', '12', '571', 'MS32', 'W', 'TXT', null, '', '', '1', ''), ('457', '4', '330', 'MS57', 'R', 'TXT', null, '', '', '1', 'inbox'), ('458', '4', '594', 'MS37', 'R', 'R7', null, '', '', '1', 'inbox'), ('492', '12', '596', 'MS69', 'R', 'TXT', null, '', '', '1', 'dialogue'), ('652', '2', '763', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('653', '2', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('654', '2', '765', null, '', '', '1', 'W', 'AUTO', null, ''), ('655', '2', '766', null, '', '', '1', 'W', 'E1.3.3.1', null, ''), ('656', '2', '767', null, '', '', '1', 'W', 'E1.3.1.1', null, ''), ('657', '6', '768', null, 'W', 'B1', '1', 'W', 'E2.9', '1', ''), ('658', '6', '769', null, 'W', 'B1', null, '', '', '1', ''), ('659', '6', '770', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('660', '6', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('661', '3', '771', null, 'W', 'B1', '1', 'W', 'E1.3.3', '1', ''), ('662', '3', '772', null, 'W', 'B1', '1', 'R', 'T7.3', '1', ''), ('663', '3', '773', null, 'W', 'B1', '1', 'R', 'T7.4', '1', ''), ('664', '3', '774', null, '', '', '1', 'W', 'E8.5', null, ''), ('665', '3', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('666', '4', '771', null, 'W', 'B1', '1', 'W', 'E1.2.1', '1', ''), ('667', '4', '775', null, 'W', 'B1', '1', 'R', 'T5.2', '1', ''), ('668', '4', '776', null, 'W', 'W2', '1', 'W', 'AUTO', '1', ''), ('669', '4', '777', null, 'N', 'B1', null, '', '', '1', ''), ('670', '4', '778', null, 'W', 'W6', '1', 'W', 'AUTO', '1', ''), ('671', '4', '779', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('672', '4', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('673', '25', '780', null, 'W', 'B1', '1', 'R', 'T2', '1', ''), ('674', '25', '781', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('675', '25', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('676', '26', '782', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('677', '26', '783', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('678', '26', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('679', '10', '784', null, 'W', 'W7', '1', 'W', 'AUTO', '1', ''), ('680', '10', '785', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('681', '10', '786', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('682', '10', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('683', '12', '787', null, 'W', 'W8', '1', 'R', 'T7.2', '1', ''), ('684', '12', '788', null, '', '', '1', 'R', 'T7.5', null, ''), ('685', '12', '789', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('686', '12', '790', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('687', '12', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('688', '11', '791', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('689', '11', '792', null, 'W', 'B1', null, '', '', '1', ''), ('690', '11', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('691', '9', '789', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('692', '9', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('693', '13', '793', null, 'W', 'B1', null, '', '', '1', ''), ('694', '13', '794', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('695', '13', '795', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('696', '13', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('697', '14', '796', null, 'W', 'B1', null, '', '', '1', ''), ('698', '14', '797', null, 'W', 'W9', '1', 'W', 'AUTO', '1', ''), ('699', '14', '798', null, 'W', 'W10', '1', 'W', 'AUTO', '1', ''), ('700', '14', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('701', '8', '799', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('702', '8', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('703', '7', '800', null, 'W', 'B1', null, '', '', '1', ''), ('704', '7', '801', null, '', '', '1', 'W', 'AUTO', null, ''), ('705', '7', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('706', '18', '802', null, 'W', 'B1', null, '', '', '1', ''), ('707', '18', '803', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('708', '18', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('709', '39', '764', null, 'W', 'B1', null, '', '', '1', ''), ('710', '15', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('711', '20', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('712', '22', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('713', '23', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', ''), ('714', '41', '804', null, 'W', 'B1', null, '', '', '1', ''), ('715', '41', '764', null, 'W', 'B1', '1', 'W', 'AUTO', '1', '');


SET FOREIGN_KEY_CHECKS = 1;";

            $connection->createCommand($mail_template)->execute();
            $connection->createCommand($mail_themes)->execute();
            $connection->createCommand($mail_character_themes)->execute();
            $transaction->commit();
        }
        catch(Exception $e)
        {
            echo "Exception: ".$e->getMessage()."\n";
            $transaction->rollback();
            return false;
        }
	}

}